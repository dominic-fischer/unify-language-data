{
  "$schema": "http://json-schema.org/draft/2020-12/schema",
  "title": "Grammar File Schema",
  "type": "object",

  "$defs": {
    "formparadigms": {
      "type": "array",
      "items": { "$ref": "#/$defs/forms" },
      "minItems": 1
    },
    "endingparadigms": {
      "type": "array",
      "items": { "$ref": "#/$defs/endings" },
      "minItems": 1
    },
    "patterns": {
      "type": "object",
      "properties": {
        "pattern": { "type": "string" },
        "examples": { "$ref": "#/$defs/examples" },
        "notes": { "$ref": "#/$defs/notes" },
        "title": { "type": "string" }
      },
      "required": ["pattern"]
    },
    "endings": {
      "type": "object",
      "properties": {
        "features": { "type": "object" },
        "ending": { "type": "string" },
        "notes": { "$ref": "#/$defs/notes" },
        "examples": { "$ref": "#/$defs/examples" },
        "title": { "type": "string" }
      },
      "required": ["features", "ending"]
    },
    "forms": {
      "type": "object",
      "properties": {
        "features": { "type": "object" },
        "form": { "type": "string" },
        "notes": { "$ref": "#/$defs/notes" },
        "examples": { "$ref": "#/$defs/examples" },
        "title": { "type": "string" }
      },
      "required": ["features", "form"]
    },
    "applies": {
      "type": "object",
      "description": "Feature-value constraints for the rule"
    },
    "examples": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "notes": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    }
  },

  "patternProperties": {
    "^[A-Z][A-Za-z0-9-]*$": {
      "type": "object",
      "required": ["Features", "Rules"],
      "properties": {
        "Features": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "Rules": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "applies": { "$ref": "#/$defs/applies" },
              "patterns": {
                "type": "array",
                "items": { "$ref": "#/$defs/patterns" }
              },
              "endingpara": {
                "type": "array",
                "items": { "$ref": "#/$defs/endings" }
              },
              "examples": { "$ref": "#/$defs/examples" },
              "notes": { "$ref": "#/$defs/notes" }
            },
          "required":["applies"],
          "oneOf":[
            {"required":["patterns"],"not":{"anyOf":[{"required":["formparadigms"]},{"required":["endingparadigms"]}]}},
            {"required":["formparadigms"],"not":{"anyOf":[{"required":["patterns"]},{"required":["endingparadigms"]}]}},
            {"required":["endingparadigms"],"not":{"anyOf":[{"required":["patterns"]},{"required":["formparadigms"]}]}}
          ]
          }
        }
      }
    }
  },

  "additionalProperties": false
}